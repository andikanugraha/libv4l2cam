/*
 motion model for smoothly moving camera
 Based upon code originally written by Justin Domke
 Copyright (C) 2009 Bob Mottram and Giacomo Spigler
 fuzzgun@gmail.com

 This program is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

#ifndef MOTIONMODEL_H_
#define MOTIONMODEL_H_

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>
#include "stereo.h"

/* ray models for Minoru webcam,
 * baseline = 60mm,
 * grid cell dimension = 32mm
 * image width = 320 pixels
 */
const int ray_model_minoru_indexes[] = {
0,0,52,247,528,866,1118,1280,1394,1480,1547,1601,1646,1684,1716,1744,1769,1791,1811,1829,1845,1860,1874,1887,1899,1910,1920,1930,1939,1947,1955,1962,1969,1975,1981,1987,1992,1997,2002,2006,2010,2014,2018,2022,2025,2028,2031,2034,2037,2040,2043,2045,2047,2049,2051,2053,2055,2057,2059,2061,2062,2063,2064,2065,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066,2066
};
int ray_model_minoru[] = {
75,82,82,82,82,81,81,81,80,80,80,80,79,79,102,125,125,124,124,123,123,123,122,122,121,121,121,120,147,267,266,265,264,263,262,262,261,260,259,258,257,256,256,359,372,371,370,369,368,366,365,364,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,3,3,3,3,3,3,3,3,3,2,2,2,4,6,6,6,6,6,6,6,6,6,6,6,6,6,7,11,11,11,11,11,11,11,11,11,11,11,11,11,11,19,20,20,20,20,20,19,19,19,19,19,19,19,19,27,32,32,32,32,32,32,32,31,31,31,31,31,31,35,49,49,49,49,49,48,48,48,48,48,47,47,47,47,69,71,70,70,70,70,69,69,69,69,68,68,68,68,85,97,97,97,96,96,96,95,95,95,94,94,94,93,102,128,128,127,127,126,126,125,125,125,124,124,123,123,123,160,162,161,161,160,160,159,159,158,158,157,157,156,156,183,199,198,198,197,196,196,195,195,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,4,4,4,4,3,3,3,3,3,4,4,4,4,5,7,7,7,7,7,8,8,8,8,8,8,8,8,8,14,14,14,14,14,14,14,14,14,14,16,15,15,15,19,21,21,21,21,22,23,23,23,22,22,22,22,22,25,33,33,32,32,32,32,32,32,32,33,33,33,33,33,41,41,41,41,41,42,42,42,42,42,42,41,41,41,48,52,52,52,52,51,51,51,51,51,51,51,51,51,53,60,60,59,59,59,59,59,59,58,58,58,58,57,57,65,65,65,65,64,64,64,64,63,63,62,62,62,61,66,69,69,69,68,67,67,66,66,66,66,65,65,65,66,68,67,67,67,67,66,66,66,66,64,63,63,63,63,68,68,68,68,67,65,65,65,64,64,64,64,64,63,62,61,61,61,61,61,60,60,60,60,57,57,57,57,58,60,60,60,59,58,57,56,56,56,56,56,56,55,55,51,51,51,50,50,50,50,50,50,48,47,47,47,47,48,48,48,48,48,46,45,45,45,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,2,3,3,3,3,3,3,3,7,8,8,8,8,8,7,10,10,10,10,10,10,10,17,21,21,21,21,21,21,23,25,25,25,25,25,25,29,43,42,42,42,42,42,42,46,46,46,46,45,45,45,66,67,66,66,66,65,65,68,68,68,67,67,67,66,79,86,86,85,85,84,84,84,84,84,83,83,82,82,85,95,94,94,94,93,93,92,90,90,89,89,88,88,87,92,92,92,91,91,90,90,87,85,85,85,84,84,83,82,81,81,80,80,79,79,77,74,74,74,73,73,73,70,66,65,65,65,64,64,63,60,59,59,59,59,58,58,50,49,49,49,49,49,48,46,45,45,44,44,44,44,38,35,35,35,35,35,35,33,32,32,32,32,32,32,29,24,24,24,24,24,24,23,22,22,22,22,22,22,21,16,16,16,16,16,16,16,15,15,15,15,14,14,14,11,10,10,10,10,10,10,10,9,9,9,9,9,9,8,6,6,6,6,6,6,6,6,6,6,6,6,6,6,4,4,4,4,4,4,4,4,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
1,1,1,1,1,1,2,2,2,2,2,3,5,5,5,5,5,8,9,9,9,9,9,15,15,15,15,15,17,24,24,24,24,25,31,37,37,35,34,34,44,47,50,50,50,50,64,64,64,63,63,68,79,79,78,78,78,86,91,91,90,94,96,106,108,107,101,101,102,111,111,115,114,113,116,120,120,119,119,118,119,119,119,118,117,117,119,119,118,117,117,116,116,115,113,109,108,107,106,104,102,101,101,98,97,97,96,96,95,82,82,81,81,81,79,76,76,76,72,68,66,64,64,62,61,60,57,56,50,49,49,48,45,45,45,45,45,40,34,34,33,33,33,32,31,31,30,26,25,23,23,23,22,22,21,20,19,16,16,16,15,15,14,14,14,14,11,10,10,10,10,10,9,9,9,8,6,6,6,6,6,6,6,5,5,4,4,4,4,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
1,1,1,1,1,3,3,3,3,5,8,8,8,8,13,17,16,16,16,27,29,29,29,29,47,47,49,51,57,75,75,74,74,87,102,101,100,100,118,126,128,135,134,157,158,157,156,158,173,172,171,170,175,183,182,185,184,188,190,189,187,186,176,172,171,170,169,166,165,158,154,152,147,146,145,144,129,115,114,113,113,107,105,99,88,88,82,81,80,80,76,56,55,55,55,53,50,50,38,38,36,34,34,34,34,23,21,21,21,21,19,19,15,13,12,12,12,12,12,9,6,6,6,6,6,6,5,3,3,3,3,3,3,3,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
1,1,1,1,4,4,4,4,10,12,12,12,22,29,27,26,37,52,53,53,67,88,87,95,109,140,139,138,148,184,182,181,185,220,226,232,231,261,259,257,262,279,278,256,252,257,248,246,245,240,238,231,215,207,202,201,199,169,145,144,143,137,130,106,101,97,91,91,88,63,59,57,54,53,43,32,32,32,29,29,21,17,16,16,16,16,8,7,7,7,7,6,3,3,3,3,3,2,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,
1,1,1,2,5,5,5,14,17,17,22,45,44,44,68,87,86,85,142,155,157,186,227,225,246,301,312,309,316,340,337,334,351,356,350,347,349,346,324,307,298,296,293,214,205,203,196,178,136,135,124,120,105,78,71,71,70,49,34,34,33,30,18,16,15,14,14,6,6,6,6,5,2,2,2,2,1,0,0,0,0,0,0,0,0,0,
1,1,1,5,7,7,17,25,23,35,64,64,74,133,143,145,242,243,258,352,373,369,406,429,425,442,463,452,451,456,431,396,377,374,346,269,256,236,204,143,142,133,118,72,70,64,63,31,29,28,28,10,10,10,9,4,3,3,3,1,1,1,1,0,0,0,0,
1,1,1,8,8,11,33,33,52,99,98,143,208,206,279,369,371,467,513,523,596,608,583,593,588,567,418,414,403,321,262,250,231,143,126,118,95,52,50,49,24,15,15,13,4,4,4,2,1,1,1,0,0,0,
1,1,3,10,8,32,43,49,138,137,229,322,295,488,523,562,690,678,732,735,654,651,638,455,432,427,238,202,194,115,81,76,51,25,24,19,6,6,5,1,1,1,0,0,0,
1,1,6,11,15,56,55,154,191,274,434,428,695,714,826,864,836,885,720,644,632,393,339,335,124,123,103,36,35,27,7,8,5,1,1,0,0,0,
1,1,8,12,38,69,120,258,275,594,601,919,916,1045,1052,890,898,655,509,482,191,188,122,52,51,16,10,8,1,1,0,0,
1,1,12,12,75,88,279,345,678,792,1067,1204,1124,1167,925,738,634,294,281,117,74,49,13,14,1,1,0,0,
1,0,14,17,103,147,408,552,1070,1234,1369,1454,1110,991,629,402,273,100,81,15,16,1,1,0,0,
0,2,17,55,143,379,593,1165,1237,1726,1391,1300,840,539,332,149,85,20,14,1,1,0,
0,3,14,68,125,452,945,1655,1927,1592,1558,737,590,169,118,22,13,1,0,0,
1,8,20,174,275,1005,1497,1830,1970,1398,928,472,323,54,34,1,2,0,
0,8,22,248,694,1137,2258,2132,1691,1241,313,208,28,12,1,0,
0,6,15,154,450,1041,3060,2590,1885,441,299,39,11,2,0,
1,20,78,412,1684,2180,2566,1935,678,314,95,28,3,0,
1,20,178,416,2180,3445,1889,1340,475,38,13,0,0,
0,2,260,1054,2232,3382,2306,602,125,31,1,0,
0,4,55,201,1059,5398,2377,815,86,2,0,
1,39,550,2050,3144,2877,842,294,192,7,
1,40,749,3170,3446,1982,566,41,0,0,
1,36,839,3730,4152,1121,100,16,0,
0,34,911,3993,3898,1096,63,0,
1,0,1266,4914,3060,706,48,0,
11,1,12,2355,7235,379,4,
2275,673,2989,2955,679,147,277,
2686,1121,4219,1854,117,0,
440,1727,5823,1934,73,0,
537,1679,5834,1904,44,0,
616,1694,6667,1010,10,
802,4304,4812,80,0,
1128,6330,2456,84,0,
698,6458,2725,116,
33,3503,6218,244,
1973,0,7992,33,
9915,0,0,84,
10000,0,0,0,
10000,0,0,
10000,0,0,
10000,0,0,
10000,0,0,
10000,0,0,
10000,0,0,
10000,0,0,
10000,0,
10000,0,
10000,0,
10000,0,
10000,0,
10000,0,
10000,0,
10000,0,
10000,0,
10000,
10000,
10000,
10000,
10000
};

class motionmodel {
protected:

public:

	motionmodel();
	virtual ~motionmodel();
};

#endif
